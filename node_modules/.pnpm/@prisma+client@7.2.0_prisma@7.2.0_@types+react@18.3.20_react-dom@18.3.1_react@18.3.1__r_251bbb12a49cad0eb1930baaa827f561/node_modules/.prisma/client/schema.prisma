generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// --- ENUMS ---

enum Role {
  ADMIN
  SEKRETARIS
  BENDAHARA
  GEMBALA
  JEMAAT
}

enum JenisKelamin {
  L
  P
}

enum StatusKeanggotaan {
  TETAP
  TITIPAN
  TAMU
}

enum StatusPernikahan {
  BELUM_MENIKAH
  MENIKAH
  CERAI_HIDUP
  CERAI_MATI
}

enum StatusSakramen {
  SUDAH
  BELUM
}

enum JabatanPendeta {
  GEMBALA_SIDANG
  WAKIL_GEMBALA
  PENDETA_MUDA
  PENATUA
  EVANGELIS
}

enum MetodeKehadiran {
  QR_CODE
  MANUAL
}

enum BannerPosition {
  TOP
  MIDDLE
  BOTTOM
}

enum JenisTransaksi {
  PEMASUKAN
  PENGELUARAN
}

// --- MODELS ---

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      Role     @default(JEMAAT)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Wilayah {
  id         String   @id @default(uuid())
  nama       String
  keterangan String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  kelompoks Kelompok[]
  jemaats   Jemaat[]

  @@map("wilayah")
}

model Kelompok {
  id        String   @id @default(uuid())
  nama      String
  ketua     String?
  jadwal    String?
  catatan   String?
  wilayahId String?  @map("wilayah_id")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  wilayah Wilayah? @relation(fields: [wilayahId], references: [id])
  jemaats Jemaat[]

  @@map("kelompok")
}

model Jemaat {
  id String @id @default(uuid())

  // A. Data Utama
  nomorInduk        String            @unique @map("nomor_induk")
  nama              String
  jenisKelamin      JenisKelamin      @map("jenis_kelamin")
  tempatLahir       String?           @map("tempat_lahir")
  tanggalLahir      DateTime          @map("tanggal_lahir")
  statusAktif       Boolean           @default(true) @map("status_aktif")
  statusKeanggotaan StatusKeanggotaan @default(TETAP) @map("status_keanggotaan")
  tanggalBergabung  DateTime          @default(now()) @map("tanggal_bergabung")
  fotoUrl           String?           @map("foto_url")
  catatanKhusus     String?           @map("catatan_khusus") @db.Text

  // B. Kontak & Alamat
  noHp     String? @map("no_hp")
  email    String?
  alamat   String? @db.Text
  kota     String?
  provinsi String?

  // C. Keluarga
  statusPernikahan StatusPernikahan @default(BELUM_MENIKAH) @map("status_pernikahan")
  namaPasangan     String?          @map("nama_pasangan")
  jumlahAnak       Int              @default(0) @map("jumlah_anak")
  isKepalaKeluarga Boolean          @default(false) @map("is_kepala_keluarga")
  noKK             String?          @map("no_kk")

  // D. Rohani
  statusBaptis  StatusSakramen @default(BELUM) @map("status_baptis")
  tanggalBaptis DateTime?      @map("tanggal_baptis")
  gerejaBaptis  String?        @map("gereja_baptis")

  statusSidi  StatusSakramen @default(BELUM) @map("status_sidi")
  tanggalSidi DateTime?      @map("tanggal_sidi")
  pendetaSidi String?        @map("pendeta_sidi")

  // E. Pekerjaan & Pendidikan
  pendidikan String?
  pekerjaan  String?
  instansi   String?

  // F. Pelayanan
  minatPelayanan     String? @map("minat_pelayanan")
  pelayananDiikuti   String? @map("pelayanan_diikuti")
  peranDalamKelompok String? @default("Anggota") @map("peran_dalam_kelompok")

  // Relasi
  wilayahId  String? @map("wilayah_id")
  kelompokId String? @map("kelompok_id")

  wilayah  Wilayah?  @relation(fields: [wilayahId], references: [id])
  kelompok Kelompok? @relation(fields: [kelompokId], references: [id])

  kehadirans Kehadiran[]
  absensi    AbsensiKehadiran[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("jemaat")
}

model Pendeta {
  id String @id @default(uuid())

  // A. Informasi Utama
  namaLengkap  String       @map("nama_lengkap")
  gelar        String?
  jenisKelamin JenisKelamin @map("jenis_kelamin")
  tempatLahir  String?      @map("tempat_lahir")
  tanggalLahir DateTime     @map("tanggal_lahir")
  statusAktif  Boolean      @default(true) @map("status_aktif")
  fotoPendeta  String?      @map("foto_pendeta")

  // B. Kontak
  noHandphone String  @map("no_handphone")
  email       String?
  alamat      String? @db.Text
  kota        String?
  provinsi    String?

  // C. Data Kepelayanan
  jabatanPelayanan  JabatanPendeta @map("jabatan_pelayanan")
  tanggalPenahbisan DateTime?      @map("tanggal_penahbisan")
  wilayahPelayanan  String?        @map("wilayah_pelayanan")
  bidangPelayanan   String?        @map("bidang_pelayanan")
  jadwalPelayanan   String?        @map("jadwal_pelayanan")
  nomorIndukPendeta String?        @map("nomor_induk_pendeta")

  // D. Keluarga
  statusPernikahan StatusPernikahan @default(BELUM_MENIKAH) @map("status_pernikahan")
  namaPasangan     String?          @map("nama_pasangan")
  jumlahAnak       Int              @default(0) @map("jumlah_anak")

  // E. Pendidikan
  pendidikanTerakhir String? @map("pendidikan_terakhir")
  institusiTeologi   String? @map("institusi_teologi")
  tahunLulus         Int?    @map("tahun_lulus")
  riwayatPendidikan  String? @map("riwayat_pendidikan") @db.Text

  // F. Media
  biografiSingkat String? @map("biografi_singkat") @db.Text
  igLink          String? @map("ig_link")
  fbLink          String? @map("fb_link")
  ytLink          String? @map("yt_link")

  // G. Internal
  catatanInternal      String? @map("catatan_internal") @db.Text
  riwayatPelayananText String? @map("riwayat_pelayanan_text") @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pendeta")
}

model Pelayanan {
  id                      String  @id @default(uuid())
  namaPelayanan           String  @map("nama_pelayanan")
  kategoriPelayanan       String  @map("kategori_pelayanan")
  deskripsiPelayanan      String? @map("deskripsi_pelayanan") @db.Text
  koordinatorPelayanan    String  @map("koordinator_pelayanan")
  jumlahKebutuhanPersonel Int     @default(0) @map("jumlah_kebutuhan_personel")
  statusPelayanan         String  @default("AKTIF") @map("status_pelayanan")
  jadwalPelayanan         String? @map("jadwal_pelayanan")
  catatanPelayanan        String? @map("catatan_pelayanan") @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("pelayanan")
}

model QrSession {
  id              String   @id @default(uuid())
  kodeQr          String   @unique @map("kode_qr")
  namaKegiatan    String   @map("nama_kegiatan")
  jenisKegiatan   String   @map("jenis_kegiatan")
  tanggalKegiatan DateTime @map("tanggal_kegiatan") @db.Date
  waktuMulai      DateTime @map("waktu_mulai")
  waktuSelesai    DateTime @map("waktu_selesai")
  statusAktif     Boolean  @default(true) @map("status_aktif")
  createdBy       String?  @map("created_by")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  kehadirans Kehadiran[]

  @@map("qr_session")
}

model Kehadiran {
  id          String          @id @default(uuid())
  jemaatId    String          @map("jemaat_id")
  qrSessionId String          @map("qr_session_id")
  waktuHadir  DateTime        @default(now()) @map("waktu_hadir")
  metode      MetodeKehadiran @default(QR_CODE)
  createdAt   DateTime        @default(now()) @map("created_at")

  jemaat    Jemaat    @relation(fields: [jemaatId], references: [id])
  qrSession QrSession @relation(fields: [qrSessionId], references: [id])

  @@unique([jemaatId, qrSessionId])
  @@map("kehadiran")
}

model Banner {
  id        String         @id @default(uuid())
  title     String?
  imageUrl  String         @map("image_url")
  kategori  String?
  tanggal   DateTime?
  position  BannerPosition
  isActive  Boolean        @default(true) @map("is_aktif")
  createdAt DateTime       @default(now()) @map("created_at")
  updatedAt DateTime       @updatedAt @map("updated_at")

  @@map("banners")
}

model AyatAlkitab {
  id           String  @id @default(uuid())
  versiAlkitab String  @map("versi_alkitab")
  kitab        String
  pasal        Int
  ayat         Int
  teksAyat     String  @map("teks_ayat") @db.Text
  bahasa       String  @default("id-ID")
  kategoriAyat String? @map("kategori_ayat")
  kataKunci    String? @map("kata_kunci")

  // TTS Fields
  ttsStatus        Boolean @default(true) @map("tts_status")
  ttsBahasa        String  @default("id-ID") @map("tts_bahasa")
  ttsKecepatanBaca String  @default("1") @map("tts_kecepatan_baca")

  // Meta
  statusTampil String  @default("AKTIF") @map("status_tampil")
  catatanAyat  String? @map("catatan_ayat") @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("ayat_alkitab")
}

model PokokDoa {
  id                  String    @id @default(uuid())
  judulPokokDoa       String    @map("judul_pokok_doa")
  kategoriDoa         String    @map("kategori_doa")
  deskripsiDoa        String    @map("deskripsi_doa") @db.Text
  pengajuDoa          String    @map("pengaju_doa")
  tanggalPengajuan    DateTime  @map("tanggal_pengajuan")
  tingkatPrioritas    String    @default("Sedang") @map("tingkat_prioritas")
  statusDoa           String    @default("AKTIF") @map("status_doa")
  tanggalTerjawab     DateTime? @map("tanggal_terjawab")
  kesaksianJawabanDoa String?   @map("kesaksian_jawaban_doa") @db.Text

  // TTS Fields
  ttsStatus        Boolean @default(true) @map("tts_status")
  ttsBahasa        String  @default("id-ID") @map("tts_bahasa")
  ttsKecepatanBaca String  @default("1") @map("tts_kecepatan_baca")

  // Meta
  statusTampil String  @default("PUBLIK") @map("status_tampil")
  catatanDoa   String? @map("catatan_doa") @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("pokok_doa")
}

model Produk {
  id        String   @id @default(uuid())
  title     String
  harga     Int
  rating    Int      @default(5)
  deskripsi String   @db.Text
  images    String[] @default([])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("produk")
}

model Transaksi {
  id                 String         @id @default(uuid())
  jenisTransaksi     JenisTransaksi @map("jenis_transaksi")
  tanggalTransaksi   DateTime       @map("tanggal_transaksi")
  kategoriTransaksi  String         @map("kategori_transaksi")
  deskripsiTransaksi String         @map("deskripsi_transaksi") @db.Text
  nominal            Int
  metodePembayaran   String         @map("metode_pembayaran")
  sumberTujuan       String         @map("sumber_tujuan")
  penanggungJawab    String         @map("penanggung_jawab")
  buktiTransaksi     String?        @map("bukti_transaksi")
  statusTransaksi    String         @default("DRAFT") @map("status_transaksi")
  catatanTransaksi   String?        @map("catatan_transaksi") @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("transaksi")
}

model Persembahan {
  id                 String   @id @default(uuid())
  jenisPersembahan   String   @map("jenis_persembahan")
  tanggalPersembahan DateTime @map("tanggal_persembahan")
  ibadahKegiatan     String   @map("ibadah_kegiatan")
  nominal            Int
  metodePemberian    String   @map("metode_pemberian")
  namaPemberi        String   @default("Anonim") @map("nama_pemberi")
  kategoriJemaat     String?  @map("kategori_jemaat")
  tujuanPersembahan  String   @map("tujuan_persembahan")
  statusPencatatan   String   @default("TERCATAT") @map("status_pencatatan")
  petugasPencatat    String   @map("petugas_pencatat")
  catatanPersembahan String?  @map("catatan_persembahan") @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("persembahan")
}

model LaporanKeuangan {
  id               String   @id @default(uuid())
  jenisLaporan     String   @map("jenis_laporan")
  tanggalMulai     DateTime @map("tanggal_mulai")
  tanggalSelesai   DateTime @map("tanggal_selesai")
  totalPemasukan   Int      @map("total_pemasukan")
  totalPengeluaran Int      @map("total_pengeluaran")
  saldoAwal        Int      @map("saldo_awal")
  saldoAkhir       Int      @map("saldo_akhir")
  ringkasanLaporan String?  @map("ringkasan_laporan") @db.Text
  disusunOleh      String   @map("disusun_oleh")
  statusLaporan    String   @default("DRAFT") @map("status_laporan")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("laporan_keuangan")
}

model KalenderEvent {
  id          String   @id @default(uuid())
  title       String
  description String?  @db.Text
  startDate   DateTime @map("start_date")
  endDate     DateTime @map("end_date")
  location    String?
  category    String?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("kalender_event")
}

model JadwalIbadah {
  id           String   @id @default(uuid())
  namaIbadah   String   @map("nama_ibadah")
  tanggal      DateTime
  waktuMulai   DateTime @map("waktu_mulai")
  waktuSelesai DateTime @map("waktu_selesai")
  lokasi       String
  pembicara    String
  tema         String?
  keterangan   String?  @db.Text

  absensi AbsensiKehadiran[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("jadwal_ibadah")
}

model KebaktianMinggu {
  id           String   @id @default(uuid())
  tanggal      DateTime
  waktu        DateTime
  tema         String
  pengkhotbah  String
  liturgos     String
  pembacaWarta String?  @map("pembaca_warta")
  catatan      String?  @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("kebaktian_minggu")
}

model AbsensiKehadiran {
  id             String          @id @default(uuid())
  jadwalIbadahId String          @map("jadwal_ibadah_id")
  jemaatId       String          @map("jemaat_id")
  waktuHadir     DateTime        @map("waktu_hadir")
  metode         MetodeKehadiran

  jadwalIbadah JadwalIbadah @relation(fields: [jadwalIbadahId], references: [id])
  jemaat       Jemaat       @relation(fields: [jemaatId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("absensi_kehadiran")
}
